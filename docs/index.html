<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#003B73" />
<title>ÉBAN Federated — Ethical Records (Demo, EN)</title>
<style>
  :root{
    --blue:#003B73;
    --blue-2:#0B2A4A;
    --navy:#002B5A;
    --terra:#D9643A;
    --terra-100:#FFE7DC;
    --green:#0EAD69;
    --bg:#F5F8FC;
    --white:#FFFFFF;
    --muted:#4a5a6c;
    --text-dark:#1a3a5a;
    --radius:14px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--blue-2);
    font:15.5px/1.55 system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    padding-bottom:80px;
  }

  /* Header */
  .eban-header{
    background:linear-gradient(180deg, var(--navy), #053566); 
    color:#fff; padding:18px 16px; text-align:center; 
    position:sticky; top:0; z-index:3; 
    box-shadow:0 6px 18px rgba(0,0,0,.08)
  }
  .eban-header h1{margin:0 0 4px; font-size:20px; letter-spacing:.3px; display:flex; align-items:center; justify-content:center; gap:8px}
  .eban-header p{margin:0; opacity:.9; font-weight:600; font-size:13.5px}

  main{padding:16px; max-width:980px; margin:0 auto}
  h2{margin:8px 0 14px; font-size:20px; letter-spacing:.2px; display:flex; align-items:center; gap:8px}

  /* Section Headers */
  .section-header{
    background:linear-gradient(135deg, rgba(0,59,115,0.08), rgba(0,59,115,0.04));
    border-left:4px solid var(--blue);
    padding:12px 16px;
    border-radius:10px;
    margin:16px 0 12px;
  }
  .section-header .title{
    font-weight:800; 
    color:var(--text-dark); 
    font-size:15px;
    letter-spacing:.3px;
    text-transform:uppercase;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .section-header .subtitle{
    font-size:13px;
    color:var(--muted);
    margin-top:4px;
  }

  .section-header.network{
    background:linear-gradient(135deg, rgba(14,173,105,0.08), rgba(14,173,105,0.04));
    border-left-color:var(--green);
  }

  /* Cards / KPIs */
  .kpi-grid{
    display:grid; 
    gap:14px; 
    grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
    animation:fadeInUp 0.5s ease;
  }
  
  @keyframes fadeInUp {
    from { opacity:0; transform:translateY(20px); }
    to { opacity:1; transform:translateY(0); }
  }

  .card{
    background:var(--white); 
    border:1px solid #E6ECF4; 
    border-radius:var(--radius);
    padding:16px 14px; 
    box-shadow:0 4px 12px rgba(0,0,0,.05);
    transition:transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  .card:hover{
    box-shadow:0 6px 16px rgba(0,0,0,.08);
  }

  .kpi{
    display:flex; 
    flex-direction:column; 
    gap:8px; 
    min-height:118px; 
    position:relative;
  }
  
  .kpi .label{
    font-weight:800; 
    font-size:13px; 
    color:#2a4564; 
    text-transform:uppercase; 
    letter-spacing:.4px;
  }
  
  .kpi .value{
    font-size:32px; 
    font-weight:900; 
    color:var(--blue-2);
    font-variant-numeric:tabular-nums;
  }
  
  .kpi .sub{
    font-size:12.5px; 
    color:var(--muted);
    margin-top:auto;
  }
  
  .kpi.badge::before{
    content:attr(data-badge); 
    position:absolute; 
    top:10px; 
    right:10px;
    background:var(--terra-100); 
    color:#9a3d23; 
    border:1px solid #f1b39e;
    padding:3px 10px; 
    border-radius:999px; 
    font-weight:800; 
    font-size:10px;
    text-transform:uppercase;
    letter-spacing:.5px;
  }

  /* FAB */
  .fab{
    position:fixed; 
    right:20px; 
    bottom:90px;
    background:var(--terra); 
    color:#fff; 
    width:60px; 
    height:60px; 
    border-radius:50%;
    border:none; 
    box-shadow:0 8px 20px rgba(217,100,58,.3);
    font-size:28px; 
    cursor:pointer; 
    display:grid; 
    place-items:center;
    transition:all 0.3s ease;
    z-index:2;
  }
  
  .fab:hover{
    background:#c54f29;
    transform:scale(1.1);
    box-shadow:0 10px 24px rgba(217,100,58,.4);
  }
  
  .fab:active{
    transform:scale(0.95);
  }
  
  .fab:focus-visible{
    outline:3px solid #fff; 
    outline-offset:3px;
  }

  /* Form */
  .form .row{display:grid; gap:10px; margin-bottom:14px}
  .form label{font-weight:800; font-size:13.5px; color:var(--text-dark)}
  .hint{
    font-size:12px; 
    color:var(--muted); 
    margin-top:4px;
    display:flex;
    align-items:flex-start;
    gap:6px;
  }
  
  input, select{
    width:100%; 
    padding:12px; 
    border-radius:10px; 
    border:2px solid #CFD6DF;
    background:#fff; 
    color:var(--blue-2); 
    font-weight:600;
    font-size:15px;
    transition:all 0.3s ease;
  }
  
  input:focus, select:focus{
    outline:none;
    border-color:var(--terra); 
    box-shadow:0 0 0 3px rgba(217,100,58,.15);
  }
  
  input.success{
    border-color:var(--green);
  }
  
  input.error{
    border-color:#E63B2E;
  }
  
  input:disabled, input[readonly]{
    background:#f0f4f8;
    color:#6b7c8f;
    cursor:not-allowed;
  }

  .field-feedback{
    display:flex;
    align-items:center;
    gap:6px;
    font-size:12px;
    font-weight:700;
    margin-top:4px;
  }
  
  .field-feedback.success{ color:var(--green); }
  .field-feedback.error{ color:#E63B2E; }
  .field-feedback.hidden{ display:none; }

  /* Checkboxes */
  .checks{display:grid; gap:10px; margin:12px 0}
  .checks label{
    display:flex; 
    gap:12px; 
    align-items:flex-start; 
    font-weight:600;
    padding:12px;
    background:rgba(0,59,115,0.03);
    border-radius:8px;
    cursor:pointer;
    transition:background 0.2s ease;
    min-height:52px;
  }
  
  .checks label:hover{
    background:rgba(0,59,115,0.06);
  }
  
  .checks input[type="checkbox"]{
    width:20px;
    height:20px;
    flex-shrink:0;
    margin-top:2px;
    cursor:pointer;
    accent-color:var(--terra);
  }

  /* Buttons */
  .save{
    width:100%; 
    padding:14px; 
    border:none; 
    border-radius:12px; 
    background:var(--terra);
    color:#fff; 
    font-weight:900; 
    font-size:15px;
    letter-spacing:.3px; 
    cursor:pointer;
    box-shadow:0 6px 16px rgba(217,100,58,.25);
    transition:all 0.3s ease;
    position:relative;
  }
  
  .save:hover:not(:disabled){
    background:#c54f29;
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(217,100,58,.35);
  }
  
  .save:active:not(:disabled){
    transform:translateY(0);
  }
  
  .save:disabled{
    background:#ccc;
    cursor:not-allowed;
    box-shadow:none;
  }
  
  .save.loading::after{
    content:'';
    position:absolute;
    top:50%;
    right:20px;
    width:18px;
    height:18px;
    margin-top:-9px;
    border:3px solid rgba(255,255,255,0.3);
    border-top-color:#fff;
    border-radius:50%;
    animation:spin 0.8s linear infinite;
  }
  
  @keyframes spin{
    to{ transform:rotate(360deg); }
  }

  .btn{
    padding:12px 20px; 
    border:none; 
    border-radius:10px; 
    background:var(--blue);
    color:#fff; 
    font-weight:700; 
    font-size:14px;
    cursor:pointer;
    transition:all 0.3s ease;
    display:inline-flex;
    align-items:center;
    gap:8px;
  }
  
  .btn:hover:not(:disabled){
    background:var(--blue-2);
    transform:translateY(-2px);
  }
  
  .btn:disabled{
    background:#ccc;
    cursor:not-allowed;
  }
  
  .btn.loading{
    position:relative;
    pointer-events:none;
  }
  
  .btn.loading::after{
    content:'';
    width:14px;
    height:14px;
    border:2px solid rgba(255,255,255,0.3);
    border-top-color:#fff;
    border-radius:50%;
    animation:spin 0.8s linear infinite;
  }

  /* Messages */
  .msg{
    padding:14px 16px; 
    border-radius:12px; 
    font-weight:700;
    margin:16px 0;
    display:flex;
    align-items:center;
    gap:10px;
    animation:slideInDown 0.4s ease;
  }
  
  @keyframes slideInDown{
    from{ opacity:0; transform:translateY(-20px); }
    to{ opacity:1; transform:translateY(0); }
  }
  
  .msg.success{
    background:rgba(14,173,105,0.1);
    color:var(--green);
    border:2px solid var(--green);
  }
  
  .msg.error{
    background:rgba(230,59,46,0.1);
    color:#E63B2E;
    border:2px solid #E63B2E;
  }

  /* Utils */
  .hidden{display:none !important}
  
  .badge-new{
    background:var(--terra);
    color:#fff;
    padding:4px 10px;
    border-radius:999px;
    font-size:11px;
    font-weight:900;
    text-transform:uppercase;
    letter-spacing:.5px;
  }

  /* Navigation */
  .nav{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    background:var(--white);
    border-top:1px solid #E6ECF4;
    display:flex;
    justify-content:space-around;
    align-items:center;
    padding:8px 0;
    box-shadow:0 -4px 12px rgba(0,0,0,.06);
    z-index:10;
  }
  
  .nav a{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:4px;
    text-decoration:none;
    color:var(--muted);
    font-size:24px;
    padding:6px 16px;
    border-radius:10px;
    transition:all 0.2s ease;
    min-width:70px;
  }
  
  .nav a span{
    font-size:11px;
    font-weight:700;
    text-transform:uppercase;
    letter-spacing:.3px;
  }
  
  .nav a:hover{
    background:rgba(0,59,115,0.05);
  }
  
  .nav a[aria-current="page"]{
    color:var(--terra);
    background:rgba(217,100,58,0.08);
  }

  /* More Menu */
  .more-menu{
    position:fixed;
    bottom:70px;
    right:16px;
    background:var(--white);
    border:1px solid #E6ECF4;
    border-radius:12px;
    box-shadow:0 8px 24px rgba(0,0,0,.12);
    padding:8px 0;
    min-width:200px;
    opacity:0;
    transform:translateY(10px) scale(0.95);
    pointer-events:none;
    transition:all 0.3s ease;
    z-index:9;
  }
  
  .more-menu.show{
    opacity:1;
    transform:translateY(0) scale(1);
    pointer-events:auto;
  }
  
  .more-menu a{
    display:flex;
    align-items:center;
    gap:12px;
    padding:12px 16px;
    text-decoration:none;
    color:var(--blue-2);
    font-weight:600;
    font-size:14px;
    transition:background 0.2s ease;
  }
  
  .more-menu a:hover{
    background:rgba(0,59,115,0.05);
  }
  
  .more-menu a span[role="img"]{
    font-size:20px;
  }

  /* Privacy Mode */
  .privacy-card{
    background:linear-gradient(135deg, rgba(14,173,105,0.08), rgba(14,173,105,0.04));
    border:2px solid var(--green);
    border-radius:var(--radius);
    padding:16px;
    margin:16px 0;
  }
  
  .privacy-toggle{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  
  .toggle-switch{
    position:relative;
    width:52px;
    height:28px;
  }
  
  .toggle-switch input{
    opacity:0;
    width:0;
    height:0;
  }
  
  .toggle-slider{
    position:absolute;
    cursor:pointer;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:#ccc;
    border-radius:28px;
    transition:0.3s;
  }
  
  .toggle-slider::before{
    position:absolute;
    content:"";
    height:20px;
    width:20px;
    left:4px;
    bottom:4px;
    background:white;
    border-radius:50%;
    transition:0.3s;
  }
  
  .toggle-switch input:checked + .toggle-slider{
    background:var(--green);
  }
  
  .toggle-switch input:checked + .toggle-slider::before{
    transform:translateX(24px);
  }

  /* Consent Cards */
  .consent-card{
    background:var(--white);
    border:2px solid #E6ECF4;
    border-radius:var(--radius);
    padding:16px;
    margin:12px 0;
  }
  
  .consent-card h3{
    margin:0 0 8px;
    font-size:16px;
    color:var(--text-dark);
  }
  
  .consent-card p{
    margin:8px 0;
    color:var(--muted);
    font-size:14px;
    line-height:1.6;
  }

  /* Profile Section */
  .profile-info{
    background:var(--white);
    border:1px solid #E6ECF4;
    border-radius:var(--radius);
    padding:20px;
    margin:16px 0;
  }
  
  .profile-row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 0;
    border-bottom:1px solid #f0f4f8;
  }
  
  .profile-row:last-child{
    border-bottom:none;
  }
  
  .profile-row .label{
    font-weight:700;
    color:var(--muted);
    font-size:13px;
    text-transform:uppercase;
    letter-spacing:.5px;
  }
  
  .profile-row .value{
    font-weight:800;
    color:var(--blue-2);
    font-size:15px;
  }

  /* Network Stats */
  .network-stats{
    display:grid;
    gap:12px;
    margin:16px 0;
  }
  
  .stat-item{
    background:var(--white);
    border:1px solid #E6ECF4;
    border-radius:10px;
    padding:16px;
    display:flex;
    justify-content:space-between;
    align-items:center;
  }
  
  .stat-item .label{
    font-weight:700;
    color:var(--muted);
    font-size:14px;
  }
  
  .stat-item .value{
    font-weight:900;
    color:var(--blue-2);
    font-size:24px;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .kpi-grid{
      grid-template-columns:1fr 1fr;
    }
    
    .fab{
      width:56px;
      height:56px;
      font-size:24px;
    }
  }
</style>
</head>
<body>

<header class="eban-header">
  <h1>
    <span role="img" aria-label="shield">🛡️</span>
    ÉBAN Federated
  </h1>
  <p>Ethical Beneficiary-Assisted Network — Demo EN</p>
</header>

<main>
  <!-- DASHBOARD -->
  <section id="dashboard">
    <div class="section-header">
      <div class="title">
        <span role="img" aria-label="chart">📊</span>
        Local Records
      </div>
      <div class="subtitle">Data stored in your organization</div>
    </div>

    <div class="kpi-grid">
      <div class="card">
        <div class="kpi">
          <div class="label">Total Cases</div>
          <div class="value" id="valLocalCases">48</div>
          <div class="sub">Registered locally</div>
        </div>
      </div>

      <div class="card">
        <div class="kpi badge" data-badge="TARGET">
          <div class="label">Consent Rate</div>
          <div class="value" id="valLocalConsent">96%</div>
          <div class="sub">46 of 48 cases</div>
        </div>
      </div>

      <div class="card">
        <div class="kpi">
          <div class="label">Anonymous</div>
          <div class="value" id="valLocalAnon">12</div>
          <div class="sub">Protected identity</div>
        </div>
      </div>
    </div>

    <div class="section-header network">
      <div class="title">
        <span role="img" aria-label="globe">🌍</span>
        Network Contribution
      </div>
      <div class="subtitle">Federated learning network statistics</div>
    </div>

    <div class="kpi-grid">
      <div class="card">
        <div class="kpi">
          <div class="label">Shared Records</div>
          <div class="value" id="valNetContrib">19</div>
          <div class="sub">Contributing to global insights</div>
        </div>
      </div>
    </div>
  </section>

  <!-- NEW CASE -->
  <section id="newCase" class="hidden">
    <h2>
      <span role="img" aria-label="new">➕</span>
      Register New Case
    </h2>

    <div class="msg success hidden" id="msgOK">
      <span role="img" aria-label="check">✓</span>
      Case registered successfully!
    </div>

    <form class="form card" id="caseForm" onsubmit="saveCase(event)">
      <div class="row">
        <label for="techName">
          Technician Name <span style="color:var(--terra)">*</span>
        </label>
        <input 
          type="text" 
          id="techName" 
          placeholder="e.g. Maria Silva"
          oninput="validateForm()"
          required
          aria-required="true"
        />
        <div class="field-feedback hidden" id="techName-feedback"></div>
      </div>

      <div class="row">
        <label for="personName">Person's Name (Optional)</label>
        <input 
          type="text" 
          id="personName" 
          placeholder="e.g. João Santos"
          oninput="validateForm()"
        />
        <div class="hint">
          <span>ℹ️</span>
          <span>If provided, a pseudonym will be auto-generated</span>
        </div>
      </div>

      <div class="row">
        <label for="pseudonym">Pseudonym</label>
        <input 
          type="text" 
          id="pseudonym" 
          placeholder="Auto-generated"
          readonly
          aria-readonly="true"
        />
      </div>

      <div class="row">
        <label for="supportType">
          Support Type <span style="color:var(--terra)">*</span>
        </label>
        <select 
          id="supportType" 
          onchange="validateForm()"
          required
          aria-required="true"
        >
          <option value="">Select type...</option>
          <option value="psychological">Psychological Support</option>
          <option value="legal">Legal Assistance</option>
          <option value="medical">Medical Care</option>
          <option value="social">Social Services</option>
          <option value="other">Other</option>
        </select>
        <div class="field-feedback hidden" id="supportType-feedback"></div>
      </div>

      <div class="checks">
        <label>
          <input type="checkbox" id="consentLocal" onchange="validateForm()" required aria-required="true" />
          <span>
            <strong>Local consent obtained</strong> (Required)<br>
            <small style="color:var(--muted)">Person authorized local data storage</small>
          </span>
        </label>

        <label>
          <input type="checkbox" id="consentFederated" />
          <span>
            <strong>Federated network consent</strong> (Optional)<br>
            <small style="color:var(--muted)">Anonymous contribution to global insights</small>
          </span>
        </label>

        <label>
          <input type="checkbox" id="anon" />
          <span>
            <strong>Anonymous mode</strong><br>
            <small style="color:var(--muted)">No identifiable information stored</small>
          </span>
        </label>
      </div>

      <button 
        type="submit" 
        class="save" 
        id="btnSave" 
        disabled 
        aria-disabled="true"
      >
        Save Case
      </button>
    </form>
  </section>

  <!-- CONSENT -->
  <section id="consent" class="hidden">
    <h2>
      <span role="img" aria-label="lock">🔏</span>
      Consent Management
    </h2>

    <div class="consent-card">
      <h3>Local Data Storage</h3>
      <p>
        <strong>Purpose:</strong> Store case information securely within your organization 
        for service delivery and quality improvement.
      </p>
      <p>
        <strong>Data retention:</strong> As per organizational policy (typically 5-7 years).
      </p>
      <p>
        <strong>Rights:</strong> Right to access, rectify, and request deletion of personal data.
      </p>
      <button class="btn" onclick="signConsent()">
        <span>✍️</span>
        Sign Digital Consent
      </button>
    </div>

    <div class="consent-card" style="border-color:var(--green)">
      <h3>Federated Network Participation</h3>
      <p>
        <strong>Purpose:</strong> Contribute anonymized insights to a federated learning network 
        to improve support services globally.
      </p>
      <p>
        <strong>Data shared:</strong> Only statistical patterns, never individual records.
      </p>
      <p>
        <strong>Privacy:</strong> Advanced cryptographic techniques ensure complete anonymity.
      </p>
      <button class="btn" onclick="signConsent()">
        <span>✍️</span>
        Sign Network Consent
      </button>
    </div>
  </section>

  <!-- NETWORK -->
  <section id="network" class="hidden">
    <h2>
      <span role="img" aria-label="network">🌍</span>
      Federated Network
    </h2>

    <div class="section-header network">
      <div class="title">Your Organization's Contribution</div>
    </div>

    <div class="network-stats">
      <div class="stat-item">
        <div class="label">Records Shared</div>
        <div class="value" id="netThisOrg">19</div>
      </div>
      <div class="stat-item">
        <div class="label">Network Nodes</div>
        <div class="value">47</div>
      </div>
      <div class="stat-item">
        <div class="label">Global Insights</div>
        <div class="value">2,341</div>
      </div>
    </div>

    <div class="card" style="margin-top:20px">
      <h3 style="margin-top:0">How it works</h3>
      <p style="color:var(--muted); line-height:1.7">
        The federated network uses privacy-preserving machine learning to generate 
        insights without sharing raw data. Each organization trains local models, 
        and only model updates (not data) are shared to improve collective understanding 
        while maintaining complete confidentiality.
      </p>
    </div>
  </section>

  <!-- PRIVACY MODE -->
  <section id="privacy" class="hidden">
    <h2>
      <span role="img" aria-label="shield">🛡️</span>
      Privacy Mode
    </h2>

    <div class="privacy-card">
      <div class="privacy-toggle">
        <div>
          <strong>Privacy Protection</strong>
          <div style="font-size:13px; color:var(--muted); margin-top:4px" id="privacyText">
            Normal mode active.
          </div>
        </div>
        <label class="toggle-switch">
          <input 
            type="checkbox" 
            id="privacyToggle" 
            onchange="togglePrivacy(this)"
            role="switch"
            aria-checked="false"
          />
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>

    <div class="card">
      <h3 style="margin-top:0">What Privacy Mode does</h3>
      <ul style="color:var(--muted); line-height:1.8">
        <li>Masks sensitive metrics on dashboards</li>
        <li>Hides technician names from display</li>
        <li>Prevents shoulder-surfing in public spaces</li>
        <li>Data remains securely stored</li>
      </ul>
      <p style="color:var(--muted); margin-top:16px; font-size:13px">
        <strong>Note:</strong> This is a display-only feature. All data remains encrypted 
        and secure regardless of this setting.
      </p>
    </div>
  </section>

  <!-- PROFILE -->
  <section id="profile" class="hidden">
    <h2>
      <span role="img" aria-label="user">👤</span>
      Technician Profile
    </h2>

    <div class="profile-info">
      <div class="profile-row">
        <div class="label">Name</div>
        <div class="value" id="profName">—</div>
      </div>
      <div class="profile-row">
        <div class="label">Tech Code</div>
        <div class="value" id="profCode">—</div>
      </div>
      <div class="profile-row">
        <div class="label">Cases Handled</div>
        <div class="value">48</div>
      </div>
      <div class="profile-row">
        <div class="label">Network Contributions</div>
        <div class="value" id="profNet">19</div>
      </div>
      <div class="profile-row">
        <div class="label">Anonymous Cases</div>
        <div class="value" id="profAnon">12</div>
      </div>
    </div>

    <button class="btn" onclick="resetDemo()" style="width:100%; margin-top:16px">
      <span>🔄</span>
      Reset Demo Data
    </button>
  </section>
</main>

<button class="fab" onclick="showScreen('newCase')" aria-label="Add new case">
  ➕
</button>

<nav class="nav" role="navigation" aria-label="Main navigation">
  <a href="#" aria-label="Dashboard" onclick="showScreen('dashboard');event.preventDefault()" aria-current="page">
    📊
    <span>Dashboard</span>
  </a>
  <a href="#" aria-label="New case" onclick="showScreen('newCase');event.preventDefault()">
    ➕
    <span>New Case</span>
  </a>
  <a href="#" aria-label="Consent" onclick="showScreen('consent');event.preventDefault()">
    🔏
    <span>Consent</span>
  </a>
  <a href="#" aria-label="Network" onclick="showScreen('network');event.preventDefault()">
    🌍
    <span>Network</span>
  </a>
  <a href="#" aria-label="More options" onclick="toggleMoreMenu();event.preventDefault()" id="moreBtn">
    ⋮
    <span>More</span>
  </a>
</nav>

<div class="more-menu" id="moreMenu">
  <a href="#" onclick="showScreen('privacy');toggleMoreMenu();event.preventDefault()">
    <span role="img" aria-label="Privacy">🛡️</span>
    Privacy Mode
  </a>
  <a href="#" onclick="showScreen('profile');toggleMoreMenu();event.preventDefault()">
    <span role="img" aria-label="Profile">👤</span>
    Technician Profile
  </a>
</div>

<script>
  // STORAGE EM MEMÓRIA
  let appState = {
    local: { cases: 48, consent: 46, anon: 12 },
    net: { contrib: 19 },
    people: [],
    techName: '',
    techCode: ''
  };

  // GERAÇÃO DE CÓDIGOS
  function randUUID(){
    return (Math.random().toString(16).slice(2) + Date.now().toString(16)).toUpperCase();
  }
  
  function genTechCode(){ 
    return 'EB-' + randUUID().slice(0,8); 
  }
  
  function genPseudonym(name){
    const base = (name || 'AN').trim().toUpperCase().slice(0,2);
    const salt = Math.floor(Math.random() * 255).toString(16).padStart(2, '0');
    const timestamp = (Date.now() % 10000).toString(16).padStart(4, '0');
    return `BEN-${base}-${timestamp}-${salt}`.toUpperCase();
  }

  // NAVEGAÇÃO
  function showScreen(id){
    document.querySelectorAll('main > section').forEach(s => s.classList.add('hidden'));
    const targetSection = document.getElementById(id);
    if (targetSection) {
      targetSection.classList.remove('hidden');
    }
    updateNav(id);
    window.scrollTo({ top: 0, behavior: 'smooth' });
    
    // Fecha more menu se aberto
    const moreMenu = document.getElementById('moreMenu');
    if (moreMenu) {
      moreMenu.classList.remove('show');
    }
  }

  function updateNav(id){
    const links = [...document.querySelectorAll('.nav a')];
    links.forEach(l => l.removeAttribute('aria-current'));
    const map = {dashboard:0, newCase:1, consent:2, network:3};
    if (map[id] != null && links[map[id]]) {
      links[map[id]].setAttribute('aria-current', 'page');
    }
  }

  function toggleMoreMenu(){
    const menu = document.getElementById('moreMenu');
    if (menu) {
      menu.classList.toggle('show');
    }
  }

  // Fecha more menu ao clicar fora
  document.addEventListener('click', (e) => {
    const menu = document.getElementById('moreMenu');
    const btn = document.getElementById('moreBtn');
    if (menu && btn && !menu.contains(e.target) && !btn.contains(e.target)){
      menu.classList.remove('show');
    }
  });

  // RENDER KPIs
  function render(mask = false){
    const L = appState.local;
    const N = appState.net;
    const consentPct = L.cases ? Math.round((L.consent / L.cases) * 100) : 0;

    const vCases = mask ? '••' : String(L.cases);
    const vConsent = mask ? '••%' : `${consentPct}%`;
    const vAnon = mask ? '••' : String(L.anon);
    const vNet = mask ? '••' : String(N.contrib);

    const elements = {
      'valLocalCases': vCases,
      'valLocalConsent': vConsent,
      'valLocalAnon': vAnon,
      'valNetContrib': vNet,
      'netThisOrg': vNet,
      'profNet': mask ? '••' : (N.contrib || 0),
      'profAnon': mask ? '••' : (L.anon || 0)
    };

    Object.keys(elements).forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.textContent = elements[id];
      }
    });
  }

  // VALIDAÇÃO DE FORM
  function validateForm(){
    const tech = document.getElementById('techName').value.trim();
    const person = document.getElementById('personName').value.trim();
    const type = document.getElementById('supportType').value;
    const cLocal = document.getElementById('consentLocal').checked;

    // Feedback inline
    const techFeedback = document.getElementById('techName-feedback');
    const techInput = document.getElementById('techName');
    if (techFeedback && techInput) {
      if (tech){
        techFeedback.textContent = '✓ Valid';
        techFeedback.className = 'field-feedback success';
        techInput.classList.add('success');
        techInput.classList.remove('error');
      } else {
        techFeedback.textContent = '❌ Technician name required';
        techFeedback.className = 'field-feedback error';
        techInput.classList.add('error');
        techInput.classList.remove('success');
      }
    }

    const typeFeedback = document.getElementById('supportType-feedback');
    const typeInput = document.getElementById('supportType');
    if (typeFeedback && typeInput) {
      if (type){
        typeFeedback.textContent = '✓ Valid';
        typeFeedback.className = 'field-feedback success';
        typeInput.classList.add('success');
        typeInput.classList.remove('error');
      } else {
        typeFeedback.textContent = '❌ Support type required';
        typeFeedback.className = 'field-feedback error';
        typeInput.classList.add('error');
        typeInput.classList.remove('success');
      }
    }

    // Gera pseudónimo se tiver nome
    const pseudonymInput = document.getElementById('pseudonym');
    if (person && pseudonymInput && !pseudonymInput.value){
      pseudonymInput.value = genPseudonym(person);
    }

    const ok = tech && type && cLocal;
    const btnSave = document.getElementById('btnSave');
    if (btnSave) {
      btnSave.disabled = !ok;
      btnSave.setAttribute('aria-disabled', String(!ok));
    }
  }

  // SALVAR CASO
  function saveCase(event){
    event.preventDefault();
    
    const tech = document.getElementById('techName').value.trim();
    const person = document.getElementById('personName').value.trim();
    const pseudonymInput = document.getElementById('pseudonym');
    const pseud = pseudonymInput ? (pseudonymInput.value.trim() || genPseudonym(person || 'Anonymous')) : genPseudonym(person || 'Anonymous');
    const type = document.getElementById('supportType').value;
    const cLocal = document.getElementById('consentLocal').checked;
    const cFed = document.getElementById('consentFederated').checked;
    const anon = document.getElementById('anon').checked;

    if (!tech || !type || !cLocal){ 
      alert('Please complete required fields');
      return;
    }

    const btnSave = document.getElementById('btnSave');
    if (btnSave) {
      btnSave.classList.add('loading');
      btnSave.disabled = true;
    }

    setTimeout(() => {
      // Gera código técnico se não existir
      if (!appState.techCode){
        appState.techCode = genTechCode();
      }
      appState.techName = tech;

      // Atualiza estado
      if (!appState.people.find(p => p.pseud === pseud)){
        appState.people.push({pseud, person: person || 'Anonymous', type});
        appState.local.cases += 1;
        appState.local.consent += 1;
        if (anon) appState.local.anon += 1;
        if (cFed) appState.net.contrib += 1;
      }

      // Atualiza perfil
      const profName = document.getElementById('profName');
      const profCode = document.getElementById('profCode');
      if (profName) profName.textContent = tech;
      if (profCode) profCode.textContent = appState.techCode;

      // Renderiza
      const privacyToggle = document.getElementById('privacyToggle');
      render(privacyToggle ? privacyToggle.checked : false);

      // Remove loading
      if (btnSave) {
        btnSave.classList.remove('loading');
      }
      
      // Mostra sucesso
      const msg = document.getElementById('msgOK');
      if (msg) {
        msg.classList.remove('hidden');
      }

      setTimeout(() => {
        if (msg) {
          msg.classList.add('hidden');
        }
        showScreen('dashboard');
        
        // Reset form
        const form = document.getElementById('caseForm');
        if (form) {
          form.reset();
        }
        document.querySelectorAll('.field-feedback').forEach(el => el.className = 'field-feedback hidden');
        document.querySelectorAll('input, select').forEach(el => {
          el.classList.remove('error', 'success');
        });
        validateForm();
      }, 2500);
    }, 1500);
  }

  // ASSINAR CONSENTIMENTO
  function signConsent(event){
    const btn = event ? event.target : null;
    if (btn) {
      btn.classList.add('loading');
      btn.disabled = true;

      setTimeout(() => {
        btn.classList.remove('loading');
        btn.disabled = false;
        alert('✓ Consent signed digitally with timestamp: ' + new Date().toLocaleString());
      }, 1200);
    }
  }

  // PRIVACY TOGGLE
  function togglePrivacy(el){
    if (!el) return;
    
    const mask = el.checked;
    const msg = document.getElementById('privacyText');
    const profName = document.getElementById('profName');
    
    if (msg) {
      if (mask){
        msg.textContent = 'Privacy ON: Names and metrics are partially masked.';
        msg.style.color = 'var(--green)';
        if (profName) profName.textContent = 'Hidden';
      } else {
        msg.textContent = 'Normal mode active.';
        msg.style.color = 'var(--blue-2)';
        if (profName) profName.textContent = appState.techName || '—';
      }
    }
    
    render(mask);
    el.setAttribute('aria-checked', String(mask));
  }

  // RESET DEMO
  function resetDemo(){
    if (confirm('Clear all demo data?')){
      appState = {
        local: { cases: 48, consent: 46, anon: 12 },
        net: { contrib: 19 },
        people: [],
        techName: '',
        techCode: ''
      };
      const privacyToggle = document.getElementById('privacyToggle');
      render(privacyToggle ? privacyToggle.checked : false);
      
      const profName = document.getElementById('profName');
      const profCode = document.getElementById('profCode');
      if (profName) profName.textContent = '—';
      if (profCode) profCode.textContent = '—';
      
      alert('Demo data cleared.');
    }
  }

  // BOOT
  window.addEventListener('load', () => {
    const techNameInput = document.getElementById('techName');
    const profName = document.getElementById('profName');
    const profCode = document.getElementById('profCode');
    
    if (appState.techName && appState.techCode){
      if (techNameInput) techNameInput.value = appState.techName;
      if (profName) profName.textContent = appState.techName;
      if (profCode) profCode.textContent = appState.techCode;
    }
    render(false);
    showScreen('dashboard');
  });
</script>

</body>
</html>
